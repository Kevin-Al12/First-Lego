<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploraci√≥n del Territorio - Guardianes del Pasado</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --verde-oscuro: #2d5016; --verde-medio: #6ea043; --marron-oscuro: #6b4423;
            --crema-claro: #f4e4c1; --dorado: #e8c17c; --marron-claro: #8b6f47;
            --texto-oscuro: #1a1a1a; --blanco: #ffffff;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--crema-claro) 0%, #fef9f0 100%);
            color: var(--texto-oscuro); font-size: 14px;
        }
        header {
            background: linear-gradient(135deg, var(--verde-oscuro) 0%, var(--verde-medio) 100%);
            padding: 0.8rem 0; position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(45, 80, 22, 0.3);
        }
        .header-content {
            max-width: 1100px; margin: 0 auto; padding: 0 1.5rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo h1 {
            font-family: 'Merriweather', serif; font-size: 1.3rem;
            color: var(--dorado); font-weight: 900;
        }
        .logo p { color: var(--crema-claro); font-size: 0.7rem; }
        nav ul { list-style: none; display: flex; gap: 1.5rem; }
        nav a {
            color: var(--crema-claro); text-decoration: none; font-weight: 500;
            font-size: 0.85rem; transition: all 0.3s; position: relative;
        }
        nav a.active { color: var(--dorado); }
        nav a::after {
            content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px;
            background: var(--dorado); transition: width 0.3s;
        }
        nav a:hover::after, nav a.active::after { width: 100%; }
        .page-hero {
            background: linear-gradient(135deg, rgba(45, 80, 22, 0.92) 0%, rgba(110, 160, 67, 0.88) 100%);
            padding: 3rem 1.5rem; text-align: center; color: var(--blanco);
        }
        .page-hero h1 {
            font-family: 'Merriweather', serif; font-size: 3rem;
            color: var(--dorado); margin-bottom: 0.6rem; font-weight: 900;
        }
        .page-hero p {
            font-size: 1.2rem; color: var(--crema-claro); max-width: 700px; margin: 0 auto;
        }
        .container { max-width: 1100px; margin: 0 auto; padding: 2.5rem 1.5rem; }
        .map-intro {
            background: var(--blanco); border-radius: 15px; padding: 2.5rem;
            margin-bottom: 2.5rem; box-shadow: 0 6px 20px rgba(45, 80, 22, 0.1);
            border: 3px solid var(--verde-medio);
        }
        .map-intro h2 {
            font-family: 'Merriweather', serif; font-size: 2rem;
            color: var(--verde-oscuro); margin-bottom: 1.2rem; text-align: center;
        }
        .map-intro p {
            font-size: 1rem; line-height: 1.6; text-align: center; color: var(--marron-claro);
        }
        .legend {
            display: flex; justify-content: center; gap: 2.5rem; flex-wrap: wrap;
            margin-top: 1.5rem; padding: 1.5rem; background: var(--crema-claro);
            border-radius: 12px;
        }
        .legend-item {
            display: flex; align-items: center; gap: 0.6rem; font-weight: 600; font-size: 0.9rem;
        }
        .legend-icon { font-size: 1.8rem; }
        #map-container {
            background: var(--blanco); border-radius: 15px; overflow: hidden;
            box-shadow: 0 10px 35px rgba(45, 80, 22, 0.2);
            border: 4px solid var(--marron-oscuro); position: relative;
        }
        #map { height: 600px; width: 100%; }
        .tour-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--verde-oscuro), var(--verde-medio));
            padding: 2.5rem; border-radius: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            z-index: 2000; max-width: 550px; width: 90%; color: var(--blanco);
            text-align: center; display: none;
        }
        .tour-modal.show { display: block; animation: modalFadeIn 0.4s ease-out; }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translate(-50%, -45%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        .tour-modal h3 {
            font-family: 'Merriweather', serif; font-size: 2.2rem;
            color: var(--dorado); margin-bottom: 1.2rem;
        }
        .tour-modal p { font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.5rem; }
        .tour-btn {
            padding: 0.9rem 2.5rem; font-size: 1rem; font-weight: 600; border: none;
            border-radius: 50px; cursor: pointer; transition: all 0.3s; margin: 0.4rem;
        }
        .tour-btn-primary {
            background: var(--dorado); color: var(--verde-oscuro);
        }
        .tour-btn-primary:hover {
            background: var(--crema-claro); transform: scale(1.05);
        }
        .tour-btn-secondary {
            background: transparent; color: var(--crema-claro); border: 2px solid var(--crema-claro);
        }
        .tour-btn-secondary:hover {
            background: var(--crema-claro); color: var(--verde-oscuro);
        }
        .tour-progress {
            position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95); padding: 1.2rem 1.8rem;
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1500; display: none; min-width: 350px;
        }
        .tour-progress.show { display: block; }
        .tour-progress-header {
            font-family: 'Merriweather', serif; font-size: 1.1rem;
            color: var(--verde-oscuro); margin-bottom: 0.8rem; text-align: center;
        }
        .tour-progress-bar {
            background: var(--crema-claro); height: 7px; border-radius: 10px;
            overflow: hidden; margin-bottom: 0.8rem;
        }
        .tour-progress-fill {
            background: linear-gradient(90deg, var(--verde-oscuro), var(--verde-medio));
            height: 100%; transition: width 0.5s ease;
        }
        .tour-controls {
            display: flex; justify-content: center; gap: 0.8rem;
        }
        .tour-control-btn {
            padding: 0.7rem 1.5rem; font-size: 0.9rem; font-weight: 600;
            border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s;
        }
        .tour-control-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .leaflet-popup-content-wrapper { border-radius: 12px !important; padding: 0 !important; }
        .popup-content { padding: 1.2rem; min-width: 260px; }
        .popup-content h3 {
            font-family: 'Merriweather', serif; font-size: 1.3rem;
            color: var(--verde-oscuro); margin-bottom: 0.4rem;
        }
        .popup-type {
            display: inline-block; padding: 0.3rem 0.7rem;
            background: var(--dorado); color: var(--marron-oscuro);
            border-radius: 15px; font-size: 0.75rem; font-weight: 600; margin-bottom: 0.8rem;
        }
        .popup-content p {
            line-height: 1.5; margin-bottom: 0.8rem; color: var(--texto-oscuro); font-size: 0.9rem;
        }
        .popup-warning {
            background: rgba(192, 57, 43, 0.1); padding: 0.7rem;
            border-radius: 8px; border-left: 3px solid #c0392b;
            font-size: 0.85rem; margin-top: 0.8rem;
        }
        .gas-legend {
            background: var(--crema-claro); padding: 0.8rem;
            border-radius: 8px; margin-top: 0.8rem;
        }
        .gas-legend h4 {
            font-size: 0.9rem; color: var(--marron-oscuro);
            margin-bottom: 0.5rem; font-weight: 700;
        }
        .gas-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.3rem 0; border-bottom: 1px solid rgba(0,0,0,0.1);
            font-size: 0.8rem;
        }
        .gas-item:last-child { border-bottom: none; }
        .gas-name { font-weight: 600; color: var(--verde-oscuro); }
        .gas-formula {
            background: var(--blanco); padding: 0.2rem 0.5rem;
            border-radius: 8px; font-family: 'Courier New', monospace;
            font-weight: 700; color: #c0392b;
        }
        .site-stats {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem; margin: 2.5rem 0;
        }
        .stat-box {
            background: linear-gradient(135deg, var(--verde-medio), var(--verde-oscuro));
            padding: 1.5rem; border-radius: 12px; text-align: center;
            color: var(--blanco); box-shadow: 0 4px 15px rgba(45, 80, 22, 0.3);
        }
        .stat-box-number {
            font-family: 'Merriweather', serif; font-size: 2.5rem;
            color: var(--dorado); font-weight: 700; margin-bottom: 0.4rem;
        }
        .stat-box-label { font-size: 0.95rem; color: var(--crema-claro); }
        footer {
            background: linear-gradient(135deg, var(--verde-oscuro) 0%, var(--marron-oscuro) 100%);
            color: var(--crema-claro); padding: 2.5rem 1.5rem 1.2rem; margin-top: 3rem;
        }
        .footer-content { max-width: 900px; margin: 0 auto; text-align: center; }
        .footer-content h3 {
            font-family: 'Merriweather', serif; font-size: 1.3rem;
            color: var(--dorado); margin-bottom: 0.8rem; font-style: italic;
        }
        .footer-content p { font-size: 0.85rem; margin: 0.3rem 0; }
        @media (max-width: 768px) {
            nav ul { flex-direction: column; gap: 0.6rem; }
            #map { height: 450px; }
            .tour-progress { min-width: auto; width: 90%; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>GUARDIANES DEL PASADO</h1>
                <p>Club de Rob√≥tica Polit√©cnico ITLA</p>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">INICIO</a></li>
                    <li><a href="proyecto.html">PROYECTO</a></li>
                    <li><a href="solucion.html">SOLUCI√ìN</a></li>
                    <li><a href="mapa.html" class="active">EXPLORACI√ìN</a></li>
                    <li><a href="juego.html">JUEGO</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="page-hero">
        <h1>Exploraci√≥n del Territorio</h1>
        <p>Sitios arqueol√≥gicos y mineros de Rep√∫blica Dominicana que requieren protecci√≥n</p>
    </div>

    <div class="container">
        <div class="map-intro">
            <h2>Mapa Interactivo de Rep√∫blica Dominicana</h2>
            <p>
                Explora los principales <strong>sitios arqueol√≥gicos ta√≠nos</strong> y <strong>√°reas mineras</strong> 
                de nuestro pa√≠s donde el ArqueoBot Guard y MaskArq Safe pueden salvar vidas. 
                Haz clic en cada marcador para conocer los gases detectados y componentes qu√≠micos.
            </p>
            
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-icon">üèõÔ∏è</span>
                    <span>Sitio Arqueol√≥gico</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">‚õèÔ∏è</span>
                    <span>Zona Minera</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">‚ö†Ô∏è</span>
                    <span>Riesgo Alto de Gases</span>
                </div>
            </div>
        </div>

        <div class="site-stats">
            <div class="stat-box">
                <div class="stat-box-number">15+</div>
                <div class="stat-box-label">Sitios Arqueol√≥gicos Identificados</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-number">8</div>
                <div class="stat-box-label">Zonas Mineras Principales</div>
            </div>
            <div class="stat-box">
                <div class="stat-box-number">23</div>
                <div class="stat-box-label">Ubicaciones de Alto Riesgo</div>
            </div>
        </div>

        <div id="map-container">
            <div id="map"></div>
            
            <div class="tour-modal" id="welcome-modal">
                <h3>üó∫Ô∏è ¬°Bienvenido al Tour Virtual!</h3>
                <p>
                    Te llevaremos en un recorrido por las zonas mineras y sitios arqueol√≥gicos m√°s importantes 
                    de Rep√∫blica Dominicana donde nuestras soluciones pueden salvar vidas.
                </p>
                <p style="font-size: 0.95rem; opacity: 0.9;">
                    El tour te mostrar√° autom√°ticamente cada ubicaci√≥n con informaci√≥n detallada sobre gases t√≥xicos.
                </p>
                <button class="tour-btn tour-btn-primary" onclick="startTour()">üöÄ Comenzar Tour</button>
                <button class="tour-btn tour-btn-secondary" onclick="skipTour()">Explorar Libremente</button>
            </div>

            <div class="tour-modal" id="end-modal">
                <h3>üéâ ¬°Tour Completado!</h3>
                <p>
                    Has explorado todas las ubicaciones clave donde el ArqueoBot Guard y MaskArq Safe 
                    son esenciales para la seguridad de arque√≥logos y mineros.
                </p>
                <p style="font-size: 0.95rem; opacity: 0.9;">
                    ¬øQuieres volver a ver el tour o explorar libremente?
                </p>
                <button class="tour-btn tour-btn-primary" onclick="restartTour()">üîÑ Reiniciar Tour</button>
                <button class="tour-btn tour-btn-secondary" onclick="closeEndModal()">‚úì Explorar Libremente</button>
            </div>

            <div class="tour-progress" id="tour-progress">
                <div class="tour-progress-header" id="progress-text">Zona 1 de 23</div>
                <div class="tour-progress-bar">
                    <div class="tour-progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <div class="tour-controls">
                    <button class="tour-control-btn" id="prev-btn" onclick="previousStop()" style="background: var(--marron-claro); color: white;">‚Üê Anterior</button>
                    <button class="tour-control-btn" id="next-btn" onclick="nextStop()" style="background: var(--verde-medio); color: white;">Siguiente ‚Üí</button>
                    <button class="tour-control-btn" onclick="endTour()" style="background: #c0392b; color: white;">‚úï Salir</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <h3>"La tecnolog√≠a no solo descubre el pasado, tambi√©n protege a quienes lo estudian"</h3>
            <p><strong>Equipo Guardianes del Pasado</strong></p>
            <p>Club de Rob√≥tica | Polit√©cnico ITLA</p>
            <p>FIRST LEGO League Challenge 2024</p>
            <p>Boca Chica, Rep√∫blica Dominicana üá©üá¥</p>
            <div style="margin-top: 1.2rem; padding-top: 1.2rem; border-top: 1px solid rgba(244, 228, 193, 0.3); font-size: 0.75rem; opacity: 0.7;">
                ¬© 2024 Guardianes del Pasado. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <script>
        const map = L.map('map').setView([18.7357, -70.1627], 9);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 18,
        }).addTo(map);

        const archaeologicalIcon = L.divIcon({
            html: '<div style="font-size: 2.2rem;">üèõÔ∏è</div>',
            className: 'custom-icon',
            iconSize: [35, 35],
            iconAnchor: [17, 35],
            popupAnchor: [0, -35]
        });

        const miningIcon = L.divIcon({
            html: '<div style="font-size: 2.2rem;">‚õèÔ∏è</div>',
            className: 'custom-icon',
            iconSize: [35, 35],
            iconAnchor: [17, 35],
            popupAnchor: [0, -35]
        });

        const tourStops = [
            {
                coords: [19.0347, -71.4394],
                type: 'mining',
                name: 'Minas de Pueblo Viejo',
                description: 'Una de las minas de oro m√°s grandes del mundo. Operaciones subterr√°neas extensas con t√∫neles profundos.',
                risk: 'EXTREMO - H‚ÇÇS, CH‚ÇÑ, CO en altas concentraciones',
                gases: ['H‚ÇÇS', 'CH‚ÇÑ', 'CO', 'CO‚ÇÇ']
            },
            {
                coords: [18.9500, -71.2500],
                type: 'mining',
                name: 'Minas de Cerro de Maim√≥n',
                description: 'Explotaci√≥n de cobre y oro. T√∫neles profundos con ventilaci√≥n controlada.',
                risk: 'ALTO - Gases industriales y metano',
                gases: ['CH‚ÇÑ', 'CO‚ÇÇ', 'SO‚ÇÇ']
            },
            {
                coords: [18.5000, -70.6667],
                type: 'mining',
                name: 'Minas de Los Cacaos',
                description: 'Antiguas minas de oro con t√∫neles abandonados que generan gases peligrosos.',
                risk: 'EXTREMO - T√∫neles sin ventilaci√≥n activa',
                gases: ['CH‚ÇÑ', 'CO‚ÇÇ', 'H‚ÇÇS', 'CO']
            },
            {
                coords: [19.6500, -70.8000],
                type: 'mining',
                name: 'Minas de Cotuy',
                description: 'Zona minera hist√≥rica con extracci√≥n de oro. Muchos t√∫neles antiguos a√∫n accesibles.',
                risk: 'ALTO - Concentraciones variables de gases',
                gases: ['CH‚ÇÑ', 'CO‚ÇÇ', 'CO']
            },
            {
                coords: [18.8000, -71.5000],
                type: 'mining',
                name: 'Minas de Las Lagunas',
                description: 'Operaciones de miner√≠a artesanal con t√∫neles sin regulaci√≥n adecuada.',
                risk: 'EXTREMO - Sin sistemas de detecci√≥n de gases',
                gases: ['CH‚ÇÑ', 'CO‚ÇÇ', 'H‚ÇÇS']
            },
            {
                coords: [18.4000, -69.5000],
                type: 'mining',
                name: 'Canteras de Piedra Caliza',
                description: 'Extracci√≥n de materiales de construcci√≥n. Espacios cerrados con poca circulaci√≥n de aire.',
                risk: 'MEDIO - CO‚ÇÇ por descomposici√≥n de carbonatos',
                gases: ['CO‚ÇÇ']
            },
            {
                coords: [19.5000, -70.5000],
                type: 'mining',
                name: 'Minas de √Åmbar - Puerto Plata',
                description: 'Extracci√≥n de √°mbar dominicano. T√∫neles estrechos en monta√±as.',
                risk: 'MEDIO - Espacios confinados con ventilaci√≥n limitada',
                gases: ['CO‚ÇÇ', 'CH‚ÇÑ']
            },
            {
                coords: [18.6000, -69.8000],
                type: 'mining',
                name: 'Minas de Larimar - Barahona',
                description: '√önica fuente mundial de larimar. T√∫neles subterr√°neos en zonas monta√±osas.',
                risk: 'ALTO - Gases volc√°nicos residuales posibles',
                gases: ['SO‚ÇÇ', 'CO‚ÇÇ', 'H‚ÇÇS']
            },
            {
                coords: [18.4242, -69.6706],
                type: 'archaeological',
                name: 'Yacimiento de La Caleta',
                description: 'Uno de los sitios arqueol√≥gicos ta√≠nos m√°s importantes de Rep√∫blica Dominicana.',
                risk: 'ALTO - Cavernas submarinas con concentraciones de CO‚ÇÇ y CH‚ÇÑ',
                gases: ['CO‚ÇÇ', 'CH‚ÇÑ']
            },
            {
                coords: [18.4785, -69.8906],
                type: 'archaeological',
                name: 'Cueva de las Maravillas',
                description: 'Sistema de cavernas con arte rupestre ta√≠no. Pictograf√≠as y petroglifos de hace m√°s de 800 a√±os.',
                risk: 'MEDIO - Espacios confinados con ventilaci√≥n limitada',
                gases: ['CO‚ÇÇ']
            },
            {
                coords: [19.4515, -70.6972],
                type: 'archaeological',
                name: 'Parque Nacional Los Haitises',
                description: 'Numerosas cuevas con arte rupestre ta√≠no. Uno de los complejos arqueol√≥gicos m√°s extensos del Caribe.',
                risk: 'ALTO - M√∫ltiples cavernas cerradas con gases acumulados',
                gases: ['CO‚ÇÇ', 'CH‚ÇÑ', 'NH‚ÇÉ']
            },
            {
                coords: [19.7476, -70.9986],
                type: 'archaeological',
                name: 'Sitio Arqueol√≥gico La Isabela',
                description: 'Primer asentamiento europeo en Am√©rica, pero con importante presencia ta√≠na anterior.',
                risk: 'BAJO - Excavaciones al aire libre',
                gases: []
            },
            {
                coords: [18.4572, -69.9489],
                type: 'archaeological',
                name: 'Cueva del Pomier',
                description: 'Sistema de 57 cuevas con la mayor concentraci√≥n de arte rupestre ta√≠no en el Caribe.',
                risk: 'ALTO - Cuevas profundas con acumulaci√≥n de gases',
                gases: ['CO‚ÇÇ', 'CH‚ÇÑ', 'NH‚ÇÉ']
            },
            {
                coords: [18.2368, -71.0965],
                type: 'archaeological',
                name: 'Sitio de Azua',
                description: 'Restos de aldeas ta√≠nas con herramientas de piedra, cer√°mica y evidencias de agricultura.',
                risk: 'MEDIO - Excavaciones con capas profundas',
                gases: ['CO‚ÇÇ']
            },
            {
                coords: [19.2823, -69.8850],
                type: 'archaeological',
                name: 'Cuevas de Borb√≥n',
                description: 'Complejos sistemas de cavernas utilizados por los ta√≠nos para ceremonias religiosas.',
                risk: 'ALTO - Ventilaci√≥n m√≠nima, gases t√≥xicos presentes',
                gases: ['CO‚ÇÇ', 'CH‚ÇÑ', 'H‚ÇÇS']
            },
            {
                coords: [18.4862, -68.9727],
                type: 'archaeological',
                name: 'Sitio de Hig√ºey',
                description: 'Antiguo cacicazgo ta√≠no. Evidencias de la chieftaincy de Hig√ºey.',
                risk: 'BAJO - Excavaciones superficiales',
                gases: []
            }
        ];

        const gasFormulas = {
            'CH‚ÇÑ': 'Metano',
            'CO‚ÇÇ': 'Di√≥xido de Carbono',
            'H‚ÇÇS': 'Sulfuro de Hidr√≥geno',
            'CO': 'Mon√≥xido de Carbono',
            'NH‚ÇÉ': 'Amon√≠aco',
            'SO‚ÇÇ': 'Di√≥xido de Azufre'
        };

        let tourActive = false;
        let currentStop = 0;
        let markers = [];

        tourStops.forEach((site, index) => {
            const icon = site.type === 'archaeological' ? archaeologicalIcon : miningIcon;
            const typeLabel = site.type === 'archaeological' ? 'Sitio Arqueol√≥gico' : 'Zona Minera';
            
            let gasLegendHTML = '';
            if (site.gases && site.gases.length > 0) {
                gasLegendHTML = `
                    <div class="gas-legend">
                        <h4>üß™ Gases Detectados:</h4>
                        ${site.gases.map(gas => `
                            <div class="gas-item">
                                <span class="gas-name">${gasFormulas[gas] || gas}</span>
                                <span class="gas-formula">${gas}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            const popupContent = `
                <div class="popup-content">
                    <h3>${site.name}</h3>
                    <span class="popup-type">${typeLabel}</span>
                    <p>${site.description}</p>
                    <div class="popup-warning">
                        <strong>‚ö†Ô∏è Nivel de Riesgo:</strong><br>
                        ${site.risk}
                    </div>
                    ${gasLegendHTML}
                </div>
            `;
            
            const marker = L.marker(site.coords, { icon: icon })
                .bindPopup(popupContent, { maxWidth: 320 })
                .addTo(map);
            
            markers.push(marker);
        });

        function startTour() {
            document.getElementById('welcome-modal').classList.remove('show');
            document.getElementById('tour-progress').classList.add('show');
            tourActive = true;
            currentStop = 0;
            showStop(currentStop);
        }

        function skipTour() {
            document.getElementById('welcome-modal').classList.remove('show');
        }

        function showStop(index) {
            if (index < 0 || index >= tourStops.length) return;
            
            const stop = tourStops[index];
            const progress = ((index + 1) / tourStops.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Zona ${index + 1} de ${tourStops.length}`;
            
            map.flyTo(stop.coords, 13, { duration: 2, easeLinearity: 0.25 });
            
            setTimeout(() => {
                markers[index].openPopup();
            }, 2000);
            
            document.getElementById('prev-btn').disabled = (index === 0);
            document.getElementById('next-btn').disabled = false;
            
            if (index === tourStops.length - 1) {
                document.getElementById('next-btn').textContent = '‚úì Finalizar';
            } else {
                document.getElementById('next-btn').textContent = 'Siguiente ‚Üí';
            }
        }

        function nextStop() {
            if (currentStop < tourStops.length - 1) {
                currentStop++;
                showStop(currentStop);
            } else {
                showEndModal();
            }
        }

        function previousStop() {
            if (currentStop > 0) {
                currentStop--;
                showStop(currentStop);
            }
        }

        function showEndModal() {
            document.getElementById('tour-progress').classList.remove('show');
            document.getElementById('end-modal').classList.add('show');
            tourActive = false;
            map.setView([18.7357, -70.1627], 9);
        }

        function closeEndModal() {
            document.getElementById('end-modal').classList.remove('show');
        }

        function restartTour() {
            document.getElementById('end-modal').classList.remove('show');
            startTour();
        }

        function endTour() {
            showEndModal();
        }

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('welcome-modal').classList.add('show');
            }, 500);
        });
    </script>
</body>
</html>